<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeOS - Piyami Baba Terminali</title>
    <style>
        :root { --bg: #05070a; --panel: #12161c; --danger: #e74c3c; --buy: #2ecc71; --sell: #3498db; --wait: #ffffff; --gold: #f0b90b; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; margin: 0; padding: 10px; }
        .dashboard { max-width: 500px; margin: auto; }
        .panel { background: var(--panel); border-radius: 12px; padding: 15px; border: 1px solid #2a3039; margin-bottom: 15px; }
        
        /* Piyami Bey'in 2 SatÄ±rlÄ± Radar YapÄ±sÄ± */
        .radar-grid { display: grid; grid-template-rows: auto auto; border-left: 4px solid var(--gold); padding-left: 12px; margin: 10px 0; }
        .line-1 { font-size: 0.9rem; color: #99a1af; }
        .line-2 { font-size: 1.1rem; font-weight: bold; }
        
        /* Renk DurumlarÄ± */
        .danger-zone { color: var(--danger); animation: pusu-blink 1s infinite; }
        .status-buy { color: var(--buy); }
        .status-sell { color: var(--sell); }
        .status-wait { color: var(--wait); }

        @keyframes pusu-blink { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        
        button { width: 100%; padding: 15px; background: var(--gold); color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .stats { display: flex; justify-content: space-between; font-size: 0.8rem; margin-top: 10px; color: #99a1af; }
        textarea { width: 100%; height: 60px; background: #1a1e23; color: #fff; border: 1px solid #333; border-radius: 8px; margin: 10px 0; padding: 10px; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="dashboard">
    <div class="panel">
        <h2 style="color:var(--gold); margin:0;">ğŸ›°ï¸ PÄ°YAMÄ° RADAR</h2>
        <div id="radarArea">
            <div class="radar-grid">
                <span class="line-1">KÃ¼resel Tarama</span>
                <span class="line-2 status-wait" id="r_main">Operasyon HazÄ±r, Emir Bekleniyor...</span>
            </div>
        </div>
    </div>

    <div class="panel" id="pusuBox" style="display:none; border-color: var(--gold);">
        <h3 style="margin:0;">ğŸ¯ AKTÄ°F PUSU (VARYANT)</h3>
        <div class="radar-grid">
            <span class="line-1" id="p_pair">Pusuda Beklenen</span>
            <span class="line-2" id="p_detail">---</span>
        </div>
        <div id="alertMsg" style="font-weight:bold; margin-top:10px;"></div>
    </div>

    <textarea id="task" placeholder="KomutanÄ±m, bugÃ¼n kimi pusuya dÃ¼ÅŸÃ¼relim?"></textarea>
    <button onclick="babaOperasyonu()">GÃ–REVÄ° BAÅLAT</button>

    <div class="stats">
        <span>GÃœNLÃœK: <b class="status-buy" id="d_pnl">$0.00</b></span>
        <span>HAFIZA: <b id="m_pnl">LifeOS Aktif</b></span>
    </div>
</div>

<audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
    const beep = document.getElementById('beep');
    let dailyTotal = 0;

    async function babaOperasyonu() {
        const q = document.getElementById('task').value;
        const mainDisp = document.getElementById('r_main');
        mainDisp.innerText = "YAMYAMLAR TAKÄ°P EDÄ°LÄ°YOR...";

        try {
            // ASÄ°STANIN BEYNÄ°NE (GEMINI) BAÄLANTI
            const res = await fetch('/api/gemini-ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ question: q })
            });
            const data = await res.json();

            // RADARI NOTLARDAKÄ° GÄ°BÄ° DOLDUR
            mainDisp.innerText = data.radar_v1;
            mainDisp.className = "line-2 " + data.radar_color;

            // PUSU KUTUSUNU AÃ‡
            document.getElementById('pusuBox').style.display = 'block';
            document.getElementById('p_pair').innerText = data.pusu.pair;
            document.getElementById('p_detail').innerText = data.pusu.action;
            document.getElementById('p_detail').className = "line-2 " + data.pusu.color_code;

            // RÄ°SK VARSA 2 BÄ°P (BABA UYARISI)
            if(data.radar_color === 'danger-zone') {
                alertSound(2);
                document.getElementById('alertMsg').innerHTML = "ğŸš¨ RÄ°SK TESPÄ°T EDÄ°LDÄ°! <br> SÄ±Ã§rama Bekleniyor!";
            } else {
                alertSound(1); // Normal operasyon onayÄ±
            }

        } catch (err) {
            mainDisp.innerText = "SÄ°STEM MEÅGUL, TEKRAR DENE";
        }
    }

    function alertSound(count) {
        let i = 0;
        const interval = setInterval(() => {
            beep.play();
            i++;
            if(i >= count) clearInterval(interval);
        }, 400);
    }
</script>

</body>
</html>
