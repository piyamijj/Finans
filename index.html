<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeOS Finans RadarÄ± v2.0 - Pro</title>
    <style>
        :root { --bg: #05070a; --gold: #f0b90b; --buy: #2ecc71; --sell: #3498db; --danger: #e74c3c; --wait: #ffffff; --yellow: #f1c40f; }
        body { background: var(--bg); color: #fff; font-family: 'Courier New', monospace; margin: 0; padding: 15px; }
        
        /* Defterdeki 2 SatÄ±rlÄ± ve NumaralÄ± YapÄ± */
        .radar-entry { border-left: 5px solid var(--gold); padding: 10px; margin-bottom: 20px; background: #0e1217; border-radius: 0 8px 8px 0; }
        .roma-num { font-weight: bold; color: var(--gold); margin-right: 10px; }
        .line-top { font-size: 1.1rem; display: block; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .line-bottom { font-size: 0.9rem; display: block; margin-top: 5px; }

        /* Defterdeki Renk MantÄ±ÄŸÄ± */
        .status-wait { color: var(--wait); }
        .status-warn { color: var(--yellow); }
        .status-danger { color: var(--danger); animation: pulse 0.5s infinite; }
        .status-buy { color: var(--buy); font-weight: bold; }
        .status-sell { color: var(--sell); font-weight: bold; }
        .status-done { color: #333; } /* Siyah/Gri: Biten iÅŸ */

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.2; } 100% { opacity: 1; } }

        .dashboard { max-width: 600px; margin: auto; }
        .stats-box { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; font-size: 0.8rem; background: #1a1e23; padding: 15px; border-radius: 10px; }
        button { width: 100%; padding: 18px; background: var(--gold); color: #000; border: none; border-radius: 10px; font-weight: bold; font-size: 1rem; cursor: pointer; margin-top: 15px; }
        textarea { width: 100%; height: 80px; background: #12161c; color: #fff; border: 1px solid #333; border-radius: 10px; padding: 10px; margin-top: 10px; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="dashboard">
    <h2 style="color:var(--gold); text-align:center; letter-spacing: 2px;">ğŸ›°ï¸ PÄ°YAMÄ° RADAR PRO</h2>
    
    <div id="radarContainer">
        <div class="radar-entry">
            <span class="line-top"><span class="roma-num">I.</span> <span id="pair_name">RADAR TARANIYOR...</span></span>
            <span class="line-bottom status-wait" id="risk_val">Beklenen SÄ±Ã§rama: %0.00</span>
        </div>
    </div>

    <div class="radar-entry" id="pusuBox" style="display:none; border-color: var(--buy);">
        <span class="line-top" id="p_action">PUSU NOKTASI</span>
        <span class="line-bottom" id="p_targets">GiriÅŸ: -- | Hedef: -- | Stop: --</span>
    </div>

    <textarea id="userInput" placeholder="Baba, bugÃ¼nkÃ¼ rÄ±zÄ±k planÄ±nÄ± baÅŸlat..."></textarea>
    <button onclick="operasyonuBaslat()">OPERASYONU BAÅLAT</button>

    <div class="stats-box">
        <div>GÃœNLÃœK GELÄ°R: <b class="status-buy" id="daily_pnl">$0.00</b></div>
        <div>YILLIK HAFIZA: <b id="yearly_pnl">LifeOS AKTÄ°F</b></div>
    </div>
</div>

<audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
    async function operasyonuBaslat() {
        const msg = document.getElementById('userInput').value;
        const mainLine = document.getElementById('pair_name');
        const riskLine = document.getElementById('risk_val');
        
        mainLine.innerText = "YAMYAMLAR Ä°ZLENÄ°YOR...";
        
        try {
            const res = await fetch('/api/gemini-ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ question: msg })
            });
            const data = await res.json();

            // Matematiksel ve GÃ¶rsel DaÄŸÄ±lÄ±m
            mainLine.innerText = data.radar_v1;
            riskLine.innerText = data.radar_v2;
            riskLine.className = "line-bottom " + data.radar_color;

            // Pusu Panelini GÃ¼ncelle (Defterdeki Gibi)
            const pBox = document.getElementById('pusuBox');
            pBox.style.display = 'block';
            pBox.style.borderColor = data.pusu.color_code === 'status-buy' ? '#2ecc71' : '#3498db';
            document.getElementById('p_action').innerText = data.pusu.pair + " - " + data.pusu.action;
            document.getElementById('p_detail').className = data.pusu.color_code;
            document.getElementById('p_targets').innerText = `G: ${data.pusu.price} | H: ${data.pusu.tp} | S: ${data.pusu.sl}`;

            // 2 Bip Sesi (Tehlike AnÄ±)
            if(data.radar_color === 'status-danger') {
                playAlert(2);
            } else {
                playAlert(1);
            }

        } catch(e) { mainLine.innerText = "BAÄLANTI HATASI!"; }
    }

    function playAlert(n) {
        let i = 0;
        const beep = document.getElementById('beep');
        const interval = setInterval(() => {
            beep.play();
            i++;
            if(i >= n) clearInterval(interval);
        }, 400);
    }
</script>
</body>
</html>
