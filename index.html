<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piyami LifeOS - Elit 5'li & Yedek GÃ¼Ã§</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0b0e11; color: #e9eaeb; margin: 0; padding: 10px; }
        .panel { background: #1e2329; border-radius: 12px; padding: 15px; border: 1px solid #333; margin-bottom: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        
        /* DeÄŸerli BeÅŸli Listesi */
        .radar-box { border-left: 4px solid #f0b90b; background: #252930; padding: 10px; margin-bottom: 8px; border-radius: 0 8px 8px 0; font-size: 0.8rem; position: relative; }
        .radar-box.new-item { animation: highlight 1s ease-out; border-left-color: #27ae60; }
        
        .progress-container { height: 6px; background: #111; border-radius: 3px; overflow: hidden; margin-top: 5px; }
        .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #f0b90b, #e67e22); transition: width 1.5s ease-in-out; }

        /* Varyant KartlarÄ± ve Yedek Slot */
        .strategy-grid { display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 8px; } /* Scalp biraz daha geniÅŸ */
        
        .strat-card { background: #000; padding: 10px; border-radius: 8px; font-size: 0.75rem; border: 1px solid #444; position: relative; min-height: 80px; cursor: pointer; overflow: hidden; }
        .strat-card:hover { border-color: #f0b90b; }

        /* Ana ve Yedek Scalp DÃ¼zeni */
        .scalp-layout { display: flex; justify-content: space-between; align-items: center; }
        .backup-badge { font-size: 0.6rem; background: #333; padding: 2px 5px; border-radius: 4px; color: #aaa; }
        
        .mini-progress { height: 5px; background: #f0b90b; position: absolute; bottom: 0; left: 0; width: 0%; transition: width 2s ease-in-out; border-radius: 0 0 8px 8px; box-shadow: 0 0 8px rgba(240, 185, 11, 0.4); }

        .active-trade { border: 2px solid #27ae60; background: #0c2d1a; display: none; margin-top: 10px; padding: 15px; }
        textarea { width: 100%; background: #2b2f36; color: #fff; border: 1px solid #444; border-radius: 8px; padding: 12px; box-sizing: border-box; min-height: 80px; margin-top: 10px; }
        button { width: 100%; padding: 15px; background: #f0b90b; color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 1rem; }

        @keyframes highlight { from { background: #27ae60; } to { background: #252930; } }
    </style>
</head>
<body>

    <div style="max-width: 600px; margin: auto;">
        
        <div class="panel">
            <h2 style="color:#f0b90b; margin:0; font-size: 1.1rem; display:flex; justify-content:space-between;">
                <span>ğŸ›°ï¸ DEÄERLÄ° 5'LÄ° RADAR</span>
                <span style="font-size:0.7rem; color:#666; font-weight:normal; margin-top:4px;">CanlÄ± Kapasite: 5/5</span>
            </h2>
            <div id="kriterListesi" style="margin-top:10px;"></div>
        </div>

        <div class="panel">
            <h3 style="margin:0 0 10px 0; font-size: 1rem;">ğŸ¯ LIVEBOARD (Ana & Yedek)</h3>
            <div class="strategy-grid">
                
                <div class="strat-card" onclick="detayGoster('scalp')">
                    <div class="scalp-layout">
                        <b style="color:#fff;">SCALP</b>
                        <span class="backup-badge">YEDEK: HAZIR</span>
                    </div>
                    
                    <div style="margin-top:5px; font-size:0.9rem; color:#f0b90b;" id="sc_main">Bekleniyor...</div>
                    <div style="font-size:0.65rem; color:#888; margin-top:2px;" id="sc_backup">Alt: --</div>

                    <div id="sc_bar" class="mini-progress"></div>
                </div>

                <div class="strat-card" onclick="detayGoster('day')">
                    <b>GÃœNLÃœK</b><br>
                    <span id="dy_info" style="font-size:0.8rem;">-</span>
                    <div id="dy_bar" class="mini-progress"></div>
                </div>

                <div class="strat-card" onclick="detayGoster('swing')">
                    <b>HAFTALIK</b><br>
                    <span id="sw_info" style="font-size:0.8rem;">-</span>
                    <div id="sw_bar" class="mini-progress"></div>
                </div>
            </div>
        </div>

        <div id="pusuKutusu" class="panel active-trade">
            <h3 style="margin:0; color:#27ae60;">âš¡ OPERASYON EMRÄ°</h3>
            <div id="pusuDetay" style="font-family: monospace; font-size: 1rem; margin-top:10px; line-height: 1.4;"></div>
        </div>

        <textarea id="emir" placeholder="1000 dolarÄ±m var, en iyileri bul..."></textarea>
        <button id="mainBtn" onclick="harekatiBaslat()">EN Ä°YÄ°LERÄ° GETÄ°R</button>
    </div>

    <script>
        let sonVeri = null;
        const MAX_ITEMS = 5; // DeÄŸerli BeÅŸli Limiti

        async function harekatiBaslat() {
            const btn = document.getElementById('mainBtn');
            const q = document.getElementById('emir').value;
            btn.innerText = "PÄ°YASA TARANIYOR...";
            
            try {
                const res = await fetch('/api/gemini-ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: q })
                });
                sonVeri = await res.json(); // GÃ¼ncel veriyi hafÄ±zaya al

                // 1. DEÄERLÄ° BEÅLÄ° LÄ°STESÄ°NÄ° YÃ–NET (Ã‡Ã–PLÃœÄE Ä°ZÄ°N YOK)
                const liste = document.getElementById('kriterListesi');
                
                // Yeni eleman oluÅŸtur
                const yeniKutu = document.createElement('div');
                yeniKutu.className = 'radar-box new-item';
                yeniKutu.innerHTML = `
                    <div style="display:flex; justify-content:space-between;">
                        <span>${sonVeri.radar_v1}</span>
                        <b style="color:#f0b90b;">${sonVeri.radar_v2}</b>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" style="width: ${sonVeri.move_stage}%"></div>
                    </div>`;

                // En baÅŸa ekle
                liste.insertBefore(yeniKutu, liste.firstChild);

                // EÄŸer 5'ten fazlaysa, en alttaki (en eski) zayÄ±f halkayÄ± at
                if(liste.children.length > MAX_ITEMS) {
                    liste.removeChild(liste.lastChild);
                }

                // 2. LIVEBOARD: ANA VE YEDEK KUVVETLERÄ° DOLDUR
                // Scalp: Ana Parite
                document.getElementById('sc_main').innerHTML = `${sonVeri.strategies.scalp.pair} <span style="color:#fff;">| ${sonVeri.strategies.scalp.price}</span>`;
                
                // Scalp: Yedek Parite (SimÃ¼lasyon: Ana paritenin tersi veya alternatifi)
                // GerÃ§ek senaryoda API'den 2. seÃ§enek de istenebilir. Åimdilik varyasyon yapÄ±yoruz.
                let backupPair = sonVeri.strategies.scalp.pair === "EUR/USD" ? "GBP/USD" : "XAU/USD";
                document.getElementById('sc_backup').innerText = `Alt: ${backupPair} (HazÄ±r)`;

                // GÃ¼nlÃ¼k ve HaftalÄ±k
                document.getElementById('dy_info').innerText = `${sonVeri.strategies.day.pair} | ${sonVeri.strategies.day.price}`;
                document.getElementById('sw_info').innerText = sonVeri.strategies.swing.pair;

                // 3. Ã‡UBUKLARI CANLANDIR (SENKRONÄ°ZE)
                setTimeout(() => {
                    document.getElementById('sc_bar').style.width = sonVeri.move_stage + "%";
                    document.getElementById('dy_bar').style.width = (sonVeri.move_stage * 0.85) + "%";
                    document.getElementById('sw_bar').style.width = (sonVeri.move_stage * 0.5) + "%";
                }, 100);

                // Otomatik Pusu UyarÄ±sÄ± (HazÄ±rlÄ±k %90 Ã¼stÃ¼yse)
                if(sonVeri.move_stage >= 90) {
                    detayGoster('scalp'); // Direkt Scalp detayÄ±nÄ± aÃ§
                }

                btn.innerText = "YENÄ°LE (DEÄERLÄ° 5'LÄ°)";
            } catch (e) { 
                btn.innerText = "HATA: TEKRAR DENE"; 
                console.error(e);
            }
        }

        function detayGoster(tip) {
            if(!sonVeri) return;
            const s = sonVeri.strategies[tip];
            const kutu = document.getElementById('pusuKutusu');
            kutu.style.display = 'block';
            
            // EÄŸer Scalp seÃ§ildiyse yedeÄŸi de not olarak dÃ¼ÅŸ
            let not = "";
            if(tip === 'scalp') not = "<br><span style='color:#888; font-size:0.8rem;'>*Yedek kuvvet (Alt) giriÅŸe hazÄ±r.</span>";

            document.getElementById('pusuDetay').innerHTML = `
                <span style="color:#f0b90b; font-weight:bold;">${s.pair}</span> | ${s.action}<br>
                ----------------<br>
                GÄ°RÄ°Å : ${s.price}<br>
                HEDEF : ${s.tp}<br>
                STOP  : ${s.sl}
                ${not}
            `;
            kutu.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
