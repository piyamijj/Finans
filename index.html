<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piyami LifeOS Otonom Muharebe Terminali</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0b0e11; color: #e9eaeb; margin: 0; padding: 10px; }
        .panel { background: #1e2329; border-radius: 12px; padding: 15px; border: 1px solid #333; margin-bottom: 10px; }
        
        /* Kriter KutularÄ± */
        .radar-box { border-left: 4px solid #f0b90b; background: #2b2f36; padding: 12px; margin-bottom: 10px; border-radius: 0 8px 8px 0; }
        .preparation-label { display: flex; justify-content: space-between; font-size: 0.75rem; color: #888; margin-bottom: 5px; }
        
        /* HazÄ±rlÄ±k Ã‡ubuklarÄ± */
        .progress-container { height: 8px; background: #111; border-radius: 4px; overflow: hidden; margin-top: 5px; }
        .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #27ae60, #2ecc71); transition: width 2s ease-in-out; }

        /* Varyant KartlarÄ± */
        .strategy-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .strat-card { background: #000; padding: 10px; border-radius: 8px; font-size: 0.75rem; border: 1px solid #444; position: relative; min-height: 65px; }
        
        /* Kart AltÄ±ndaki SarÄ± HazÄ±rlÄ±k Ã‡izgisi */
        .mini-progress { height: 5px; background: #333; position: absolute; bottom: 0; left: 0; width: 0%; background: #f0b90b; transition: 2s ease-in-out; border-radius: 0 0 8px 8px; }

        .active-trade { border: 2px solid #27ae60; background: #0c2d1a; display: none; }
        textarea { width: 100%; background: #2b2f36; color: #fff; border: 1px solid #444; border-radius: 8px; padding: 12px; box-sizing: border-box; min-height: 90px; margin-top: 10px; }
        button { width: 100%; padding: 15px; background: #f0b90b; color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

    <div style="max-width: 600px; margin: auto;">
        <div class="panel">
            <h2 style="color:#f0b90b; margin:0; font-size: 1.2rem;">ğŸ›°ï¸ PÄ°YAMÄ° MUHAREBE RADARI</h2>
            <div id="statusText" style="font-size: 0.75rem; margin: 10px 0; color: #aaa;">Radar taranÄ±yor...</div>
            <div id="kriterListesi"></div>
        </div>

        <div class="panel">
            <h3 style="margin:0 0 10px 0; font-size: 1rem;">ğŸ¯ VARYANT HAZIRLIKLARI</h3>
            <div class="strategy-grid">
                <div class="strat-card">
                    <b>SCALP</b><br><span id="sc_info">Bekleniyor...</span>
                    <div id="sc_bar" class="mini-progress"></div>
                </div>
                <div class="strat-card">
                    <b>GÃœNLÃœK</b><br><span id="dy_info">Bekleniyor...</span>
                    <div id="dy_bar" class="mini-progress"></div>
                </div>
                <div class="strat-card">
                    <b>HAFTALIK</b><br><span id="sw_info">-</span>
                    <div id="sw_bar" class="mini-progress"></div>
                </div>
            </div>
        </div>

        <div id="pusuKutusu" class="panel active-trade">
            <h3 style="margin:0; color:#27ae60;">ğŸš¨ PUSU TETÄ°KLENDÄ°!</h3>
            <div id="pusuDetay" style="font-family: monospace; font-size: 1.1rem; margin-top:10px;"></div>
        </div>

        <textarea id="emir" placeholder="1000 dolarÄ±m var ne yapabilirim"></textarea>
        <button id="mainBtn" onclick="harekatiBaslat()">HAREKATI BAÅLAT</button>
    </div>

    <script>
        async function harekatiBaslat() {
            const btn = document.getElementById('mainBtn');
            const q = document.getElementById('emir').value;
            btn.innerText = "VERÄ°LER Ä°ÅLENÄ°YOR...";
            
            try {
                const res = await fetch('/api/gemini-ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: q })
                });
                const data = await res.json();

                // 1. Ãœst Listeyi GÃ¼ncelle (Zincirleme)
                const liste = document.getElementById('kriterListesi');
                const yeniKriter = `
                    <div class="radar-box">
                        <div class="preparation-label">
                            <span>${data.radar_v1}</span>
                            <b style="color:#f0b90b;">${data.radar_v2}</b>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: ${data.move_stage}%"></div>
                        </div>
                        <div style="font-size: 0.65rem; text-align: right; margin-top:3px;">HazÄ±rlÄ±k: %${data.move_stage}</div>
                    </div>`;
                liste.innerHTML = yeniKriter + liste.innerHTML;

                // 2. KARTLARI VE SARI Ã‡Ä°ZGÄ°LERÄ° SENKRONÄ°ZE ET
                // Scalp Senkronu
                document.getElementById('sc_info').innerHTML = `${data.strategies.scalp.pair}<br>G: ${data.strategies.scalp.price}`;
                document.getElementById('sc_bar').style.width = data.move_stage + "%";

                // GÃ¼nlÃ¼k Senkronu
                document.getElementById('dy_info').innerHTML = `${data.strategies.day.pair}<br>G: ${data.strategies.day.price}`;
                document.getElementById('dy_bar').style.width = (data.move_stage * 0.9) + "%"; 

                // 3. Pusu Tetikleme (%90 ve Ã¼zeri hazÄ±rlÄ±kta)
                if(data.move_stage >= 90) {
                    const pusu = document.getElementById('pusuKutusu');
                    pusu.style.display = 'block';
                    document.getElementById('pusuDetay').innerHTML = `
                        ${data.strategies.scalp.pair} | ${data.strategies.scalp.action}<br>
                        GÄ°RÄ°Å: ${data.strategies.scalp.price} | HEDEF: ${data.strategies.scalp.tp}
                    `;
                }

                btn.innerText = "HAREKATI BAÅLAT";
            } catch (e) { 
                btn.innerText = "BAÄLANTI HATASI";
            }
        }
    </script>
</body>
</html>
