<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeOS - Piyami Baba RadarÄ±</title>
    <style>
        :root { --bg: #05070a; --card: #12161c; --gold: #f0b90b; --buy: #2ecc71; --sell: #3498db; --danger: #e74c3c; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 12px; }
        
        /* Defterdeki 2 SatÄ±rlÄ± Radar YapÄ±sÄ± */
        .radar-box { border-left: 4px solid var(--gold); padding-left: 12px; margin-bottom: 20px; }
        .line-1 { font-size: 0.85rem; color: #888; display: block; }
        .line-2 { font-size: 1.1rem; font-weight: bold; display: block; margin-top: 2px; }

        /* Renk KodlarÄ± (Deftere SadÄ±k) */
        .white { color: #ffffff; } 
        .green { color: var(--buy); } /* AlÄ±ÅŸ ve KÃ¢r */
        .blue { color: var(--sell); } /* SatÄ±ÅŸ */
        .danger { color: var(--danger); animation: pusu-blink 0.8s infinite; }

        .panel { background: var(--card); border-radius: 12px; padding: 15px; border: 1px solid #2a3039; margin-bottom: 15px; }
        
        /* Grafik AlanÄ± (Defterdeki Ã‡izim HatlarÄ±) */
        .spark-graph { height: 40px; border-bottom: 1px solid #333; margin: 10px 0; position: relative; }
        .spark-graph::after { content: ""; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg, transparent, var(--gold), transparent); }

        textarea { width: 100%; background: #1a1e23; color: #fff; border: 1px solid #333; border-radius: 8px; padding: 10px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: var(--gold); border: none; border-radius: 8px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        
        @keyframes pusu-blink { 50% { opacity: 0.3; } }
    </style>
</head>
<body>

<div class="dashboard">
    <div class="panel">
        <h3 style="color:var(--gold); margin:0 0 10px 0;">ğŸ›°ï¸ PÄ°YAMÄ° FÄ°NANS RADARI</h3>
        <div class="radar-box">
            <span class="line-1">KÃ¼resel Tarama & Jeopolitik Hat</span>
            <span class="line-2 white" id="r_main">Pusu Ä°Ã§in Emir Bekleniyor...</span>
        </div>
    </div>

    <div class="panel" id="pusuPanel" style="display:none; border-color: var(--gold);">
        <span class="line-1">GÃ¶rÃ¼lecek Ä°ÅŸlem (2 SatÄ±r)</span>
        <div class="radar-box" style="border-left-color: var(--sell);">
            <span class="line-2" id="p_pair">---</span>
            <span class="line-2" id="p_detail">---</span>
        </div>
        <div class="spark-graph"></div> <div id="alertTxt" style="font-weight:bold; margin-top:5px;"></div>
    </div>

    <textarea id="taskInput" placeholder="Baba, pusu yerini tarif et..."></textarea>
    <button onclick="calis()">OPERASYONU BAÅLAT</button>

    <div style="display:flex; justify-content:space-between; padding:10px; font-size:0.8rem; color:#666;">
        <span>GÃœNLÃœK GELÄ°R: <b class="green" id="d_pnl">$0.00</b></span>
        <span>HAFIZA: <b>LifeOS Aktif</b></span>
    </div>
</div>

<audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
    async function calis() {
        const q = document.getElementById('taskInput').value;
        const mainLine = document.getElementById('r_main');
        mainLine.innerText = "ARAÅTIRILIYOR...";

        try {
            const res = await fetch('/api/gemini-ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ question: q })
            });
            const data = await res.json();

            // Defterdeki 2 satÄ±rlÄ± radar gÃ¼ncellemesi
            mainLine.innerText = data.radar_v1 || "Analiz Tamam";
            mainLine.className = "line-2 " + (data.radar_color || "white");

            // Pusu kartÄ± detaylarÄ±
            document.getElementById('pusuPanel').style.display = 'block';
            document.getElementById('p_pair').innerText = data.pusu.pair;
            document.getElementById('p_detail').innerText = data.pusu.action;
            document.getElementById('p_detail').className = "line-2 " + data.pusu.color_code;

            // Sesli ve gÃ¶rsel uyarÄ±lar (2 Bip)
            if(data.radar_color === 'danger-zone') {
                playBeep(2);
                document.getElementById('alertTxt').innerHTML = "<span class='danger'>ğŸš¨ RÄ°SK ANALÄ°ZÄ°: SÄ±Ã§rama KapÄ±da!</span>";
            } else {
                playBeep(1);
                document.getElementById('alertTxt').innerHTML = "<span class='green'>âœ… Pusu NoktasÄ± Stabil.</span>";
            }
        } catch(e) { mainLine.innerText = "HATA: Tekrar Dene"; }
    }

    function playBeep(n) {
        let c = 0;
        const iv = setInterval(() => {
            document.getElementById('beep').play();
            c++; if(c>=n) clearInterval(iv);
        }, 400);
    }
</script>
</body>
</html>
